# ClickHouse only â€” for sync integration tests (including dictionary metadata).
# Official image sets default user password from CLICKHOUSE_PASSWORD so dictionary
# sync (SHOW CREATE DICTIONARY, system.columns) works. For Altinity image use
# equivalent users.d config (see clickhouse-users.d/default-password.xml).
# From repo root:
#   docker compose -f docker-compose.test.yml up -d
#   cd cli && cp tests/nao_core/commands/sync/integration/.env.example \
#        tests/nao_core/commands/sync/integration/.env
#   uv run pytest tests/nao_core/commands/sync/integration/test_clickhouse.py -v
# Stop: docker compose -f docker-compose.test.yml down

services:
    clickhouse:
        image: clickhouse/clickhouse-server:25.3
        container_name: nao_test_clickhouse
        environment:
            CLICKHOUSE_DB: default
            CLICKHOUSE_USER: default
            CLICKHOUSE_PASSWORD: admin
            CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: 1
        ports:
            - '8123:8123'
            - '9000:9000'
        healthcheck:
            test: ['CMD', 'wget', '-q', '-O', '-', 'http://localhost:8123/ping']
            interval: 5s
            timeout: 5s
            retries: 5
